<?php
/**
 * ===================================
 * API: à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸´à¸™à¸„à¹‰à¸² 1 à¸£à¸²à¸¢à¸à¸²à¸£ (Get One Product)
 * ===================================
 * Method: GET
 * Query: ?id=123
 *
 * ðŸŽ¯ Challenge: à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™à¸•à¹‰à¸­à¸‡à¹€à¸‚à¸µà¸¢à¸™ SQL SELECT à¹€à¸­à¸‡!
 * ===================================
 */

session_start();
require_once '../../config/database.php';
require_once '../../includes/cors.php';

// à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡ login à¸à¹‡à¸”à¸¹à¹„à¸”à¹‰ (à¸ªà¸³à¸«à¸£à¸±à¸šà¸«à¸™à¹‰à¸²à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸ªà¸´à¸™à¸„à¹‰à¸²)

if (empty($_GET['id'])) {
    sendResponse(400, 'à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸ ID à¸ªà¸´à¸™à¸„à¹‰à¸²');
}

$id = (int) $_GET['id'];

try {
    // ===================================
    // ðŸŽ¯ TODO: à¹€à¸‚à¸µà¸¢à¸™ SQL SELECT à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸´à¸™à¸„à¹‰à¸²
    // ===================================
    //
    // ðŸ“ Hint: à¹ƒà¸Šà¹‰ JOIN à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¶à¸‡à¸Šà¸·à¹ˆà¸­à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¸¡à¸²à¸”à¹‰à¸§à¸¢
    //
    // SELECT p.*, c.name AS category_name
    // FROM products p
    // LEFT JOIN categories c ON p.category_id = c.id
    // WHERE p.id = ?
    //
    // ===================================

    // TODO: à¹€à¸‚à¸µà¸¢à¸™ SQL SELECT à¸žà¸£à¹‰à¸­à¸¡ JOIN
    $sql = "SELECT
                p.*,
                c.____________ AS category_name
            FROM ____________ p
            LEFT JOIN ____________ c ON p.____________ = c.____________
            WHERE p.____________ = ?";

    // TODO: prepare à¹à¸¥à¸° execute
    $stmt = $pdo->____________($sql);
    $stmt->____________([____________]);

    // TODO: à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ 1 à¹à¸–à¸§
    $product = $stmt->____________();

    // ===================================

    if (!$product) {
        sendResponse(404, 'à¹„à¸¡à¹ˆà¸žà¸šà¸ªà¸´à¸™à¸„à¹‰à¸²');
    }

    sendResponse(200, 'à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸´à¸™à¸„à¹‰à¸²à¸ªà¸³à¹€à¸£à¹‡à¸ˆ', $product);

} catch (PDOException $e) {
    sendResponse(500, 'Database error: ' . $e->getMessage());
}
?>
